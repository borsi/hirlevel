var sectionheader ='<tr><td align="center" colspan="6" height="78" style="height:78px;font-family:Arial,Helvetica,sans-serif;font-size:40px;text-align:center;vertical-align:middle;width:600px;" valign="middle" width="600"><a href="http://clickshop.hu/iskolakezdes-akciok/elektronika/tv-dvd/?utm_source=optimail&utm_campaign=BTS&utm_medium=edm_09_09" style="color:#962375;text-decoration:none;" target="_blank"><span style="color:#962375;">Televíziók</span></a><a id="delete" class="donotsave" style="float:right; font-size:9px;" href="#">töröl</a></td></tr>'; 
var section = '<tr><td colspan="6" height="30" style="font-size:0;height:30px;line-height:0;vertical-align:top;width:600px;" valign="top" width="600"><img class="spacer" alt="" border="0" height="30" src="http://static.origos.hu/s/partners/maileon/img/clickshop/hirlevel/spacer.jpg" style="border:0;display:block;height:30px;width:600px;" width="600"/></td></tr><tr><td colspan="6" height="300" style="height:300px;vertical-align:top;width:600px;" valign="top" width="600"><table align="center" bgcolor="#ffffff" border="0" cellspacing="0" cellpadding="0" style="border:0;margin:0 auto;padding:0;width:600px;" width="600"><tr><a id="delete" class="donotsave" style="float:right; font-size:9px; z-index:500;" href="#">töröl</a><td height="300" style="height:300px;vertical-align:top;width:196px;" valign="top" width="196"><table align="center" bgcolor="#ffffff" border="0" cellspacing="0" cellpadding="0" style="border:0;margin:0 auto;padding:0;width:196px;" width="196"><tr><td colspan="2" height="147" style="height:147px;vertical-align:top;width:196px;" valign="top" width="196"><a href="http://clickshop.hu/sony-kdl32r430bbaep-led-lcd-televizio--17940/?utm_source=optimail&utm_campaign=BTS&utm_medium=edm_09_09" style="text-decoration:none;" target="_blank"><img alt="" border="0" src="http://static.origos.hu/s/partners/maileon/img/clickshop/hirlevel/04-tv-sony-kdlr32.jpg" style="border:0;display:block;height:147px;width:196px;" width="196"/></a></td></tr><tr><td align="left" bgcolor="#f7f6f6" colspan="2" height="48" style="background:#f7f6f6;font-family:Arial,Helvetica,sans-serif;font-size:14px;height:48px;padding:0px 10px 0px 10px;text-align:left;vertical-align:middle;width:196px;" valign="middle" width="196"><a href="http://clickshop.hu/sony-kdl32r430bbaep-led-lcd-televizio--17940/?utm_source=optimail&utm_campaign=BTS&utm_medium=edm_09_09" style="color:#941e63;text-decoration:none;" target="_blank"><span style="color:#941e63;">Sony KDL32R430BBAEP LED LCD televízió</span></a></td></tr><tr><td align="left" bgcolor="#f7f6f6" colspan="2" height="40" style="background:#f7f6f6;font-family:Arial,Helvetica,sans-serif;font-size:14px;height:40px;padding:0px 10px 0px 10px;text-align:left;vertical-align:top;width:196px;" valign="top" width="196"><a href="http://clickshop.hu/sony-kdl32r430bbaep-led-lcd-televizio--17940/?utm_source=optimail&utm_campaign=BTS&utm_medium=edm_09_09" style="color:#8e8d8d;text-decoration:none;" target="_blank"><span style="color:#8e8d8d;">FULL HD, 100 Hz, 2 év garanciával</span></a></td></tr><tr><td align="left" bgcolor="#f7f6f6" height="29" style="background:#f7f6f6;font-family:Arial,Helvetica,sans-serif;font-size:12px;height:29px;padding:0px 0px 0px 10px;text-align:left;vertical-align:top;width:110px;" valign="top" width="120"><a href="http://clickshop.hu/sony-kdl32r430bbaep-led-lcd-televizio--17940/?utm_source=optimail&utm_campaign=BTS&utm_medium=edm_09_09" style="color:#8e8d8d;text-decoration:none;" target="_blank"><span style="color:#8e8d8d;">94.990 Ft helyett</span></a></td><td align="left" bgcolor="#f7f6f6" height="29" style="background:#f7f6f6;font-family:Arial,Helvetica,sans-serif;font-size:15px;height:29px;text-align:left;vertical-align:top;width:76px;" valign="top" width="76"><a href="http://clickshop.hu/sony-kdl32r430bbaep-led-lcd-televizio--17940/?utm_source=optimail&utm_campaign=BTS&utm_medium=edm_09_09" style="color:#085b7e;text-decoration:none;" target="_blank"><b><span style="color:#085b7e;">84.990 Ft</span></b></a></td></tr><tr><td bgcolor="#9a2067" colspan="2" height="36" style="background:#9a2067;font-family:Arial,Helvetica,sans-serif;font-size:15px;height:36px;text-align:center;vertical-align:middle;width:196px;" valign="top" width="196"><a href="http://clickshop.hu/sony-kdl32r430bbaep-led-lcd-televizio--17940/?utm_source=optimail&utm_campaign=BTS&utm_medium=edm_09_09" style="color:#ffffff;display:block;text-decoration:none;" target="_blank"><span style="color:#ffffff;">MEGNÉZEM</span></a></td></tr></table></td><td height="300" style="height:300px;vertical-align:top;width:6px;" valign="top" width="6">&nbsp;</td><td height="300" style="height:300px;vertical-align:top;width:196px;" valign="top" width="196"><table align="center" bgcolor="#ffffff" border="0" cellspacing="0" cellpadding="0" style="border:0;margin:0 auto;padding:0;width:196px;" width="196"><tr><td colspan="2" height="147" style="height:147px;vertical-align:top;width:196px;" valign="top" width="196"><a href="http://clickshop.hu/panasonic-tx32a300-hd-ready-led-televizio--20677/?utm_source=optimail&utm_campaign=BTS&utm_medium=edm_09_09" style="text-decoration:none;" target="_blank"><img alt="" border="0" src="http://static.origos.hu/s/partners/maileon/img/clickshop/hirlevel/TV-Panasonic-TX32A300.jpg" style="border:0;display:block;height:147px;width:196px;" width="196"/></a></td></tr><tr><td align="left" bgcolor="#f7f6f6" colspan="2" height="48" style="background:#f7f6f6;font-family:Arial,Helvetica,sans-serif;font-size:14px;height:48px;padding:0px 10px 0px 10px;text-align:left;vertical-align:middle;width:196px;" valign="middle" width="196"><a href="http://clickshop.hu/panasonic-tx32a300-hd-ready-led-televizio--20677/?utm_source=optimail&utm_campaign=BTS&utm_medium=edm_09_09" style="color:#941e63;text-decoration:none;" target="_blank"><span style="color:#941e63;">Panasonic TX32A300</span></a></td></tr><tr><td align="left" bgcolor="#f7f6f6" colspan="2" height="40" style="background:#f7f6f6;font-family:Arial,Helvetica,sans-serif;font-size:14px;height:40px;padding:0px 10px 0px 10px;text-align:left;vertical-align:top;width:196px;" valign="top" width="196"><a href="http://clickshop.hu/panasonic-tx32a300-hd-ready-led-televizio--20677/?utm_source=optimail&utm_campaign=BTS&utm_medium=edm_09_09" style="color:#8e8d8d;text-decoration:none;" target="_blank"><span style="color:#8e8d8d;">Panasonic TV ennyiért?</span></a></td></tr><tr><td align="left" bgcolor="#f7f6f6" height="29" style="background:#f7f6f6;font-family:Arial,Helvetica,sans-serif;font-size:12px;height:29px;padding:0px 0px 0px 10px;text-align:left;vertical-align:top;width:110px;" valign="top" width="120"><a href="http://clickshop.hu/panasonic-tx32a300-hd-ready-led-televizio--20677/?utm_source=optimail&utm_campaign=BTS&utm_medium=edm_09_09" style="color:#8e8d8d;text-decoration:none;" target="_blank"><span style="color:#8e8d8d;">74.990 Ft helyett</span></a></td><td align="left" bgcolor="#f7f6f6" height="29" style="background:#f7f6f6;font-family:Arial,Helvetica,sans-serif;font-size:15px;height:29px;text-align:left;vertical-align:top;width:76px;" valign="top" width="76"><a href="http://clickshop.hu/panasonic-tx32a300-hd-ready-led-televizio--20677/?utm_source=optimail&utm_campaign=BTS&utm_medium=edm_09_09" style="color:#085b7e;text-decoration:none;" target="_blank"><b><span style="color:#085b7e;">62.990 Ft</span></b></a></td></tr><tr><td bgcolor="#9a2067" colspan="2" height="36" style="background:#9a2067;font-family:Arial,Helvetica,sans-serif;font-size:15px;height:36px;text-align:center;vertical-align:middle;width:196px;" valign="top" width="196"><a href="http://clickshop.hu/panasonic-tx32a300-hd-ready-led-televizio--20677/?utm_source=optimail&utm_campaign=BTS&utm_medium=edm_09_09" style="color:#ffffff;display:block;text-decoration:none;" target="_blank"><span style="color:#ffffff;">MEGNÉZEM</span></a></td></tr></table></td><td height="300" style="height:300px;vertical-align:top;width:6px;" valign="top" width="6">&nbsp;</td><td height="300" style="height:300px;vertical-align:top;width:196px;" valign="top" width="196"><table align="center" bgcolor="#ffffff" border="0" cellspacing="0" cellpadding="0" style="border:0;margin:0 auto;padding:0;width:196px;" width="196"><tr><td colspan="2" height="147" style="height:147px;vertical-align:top;width:196px;" valign="top" width="196"><a href="http://clickshop.hu/lg-42lb5610-full-hd-led-televizio--20678/?utm_source=optimail&utm_campaign=BTS&utm_medium=edm_09_09" style="text-decoration:none;" target="_blank"><img alt="" border="0" src="http://static.origos.hu/s/partners/maileon/img/clickshop/hirlevel/TV-LG-42LB5610.jpg" style="border:0;display:block;height:147px;width:196px;" width="196"/></a></td></tr><tr><td align="left" bgcolor="#f7f6f6" colspan="2" height="48" style="background:#f7f6f6;font-family:Arial,Helvetica,sans-serif;font-size:14px;height:48px;padding:0px 10px 0px 10px;text-align:left;vertical-align:middle;width:196px;" valign="middle" width="196"><a href="http://clickshop.hu/lg-42lb5610-full-hd-led-televizio--20678/?utm_source=optimail&utm_campaign=BTS&utm_medium=edm_09_09" style="color:#941e63;text-decoration:none;" target="_blank"><span style="color:#941e63;">LG 42LB5610 Full HD LED TV</span></a></td></tr><tr><td align="left" bgcolor="#f7f6f6" colspan="2" height="40" style="background:#f7f6f6;font-family:Arial,Helvetica,sans-serif;font-size:14px;height:40px;padding:0px 10px 0px 10px;text-align:left;vertical-align:top;width:196px;" valign="top" width="196"><a href="http://clickshop.hu/lg-42lb5610-full-hd-led-televizio--20678/?utm_source=optimail&utm_campaign=BTS&utm_medium=edm_09_09" style="color:#8e8d8d;text-decoration:none;" target="_blank"><span style="color:#8e8d8d;">42" Full HD a legjobb áron!</span></a></td></tr><tr><td align="left" bgcolor="#f7f6f6" height="29" style="background:#f7f6f6;font-family:Arial,Helvetica,sans-serif;font-size:12px;height:29px;padding:0px 0px 0px 10px;text-align:left;vertical-align:top;width:110px;" valign="top" width="120"><a href="http://clickshop.hu/lg-42lb5610-full-hd-led-televizio--20678/?utm_source=optimail&utm_campaign=BTS&utm_medium=edm_09_09" style="color:#8e8d8d;text-decoration:none;" target="_blank"><span style="color:#8e8d8d;">119.990 Ft helyett</span></a></td><td align="left" bgcolor="#f7f6f6" height="29" style="background:#f7f6f6;font-family:Arial,Helvetica,sans-serif;font-size:15px;height:29px;text-align:left;vertical-align:top;width:76px;" valign="top" width="76"><a href="http://clickshop.hu/lg-42lb5610-full-hd-led-televizio--20678/?utm_source=optimail&utm_campaign=BTS&utm_medium=edm_09_09" style="color:#085b7e;text-decoration:none;" target="_blank"><b><span style="color:#085b7e;">98.890 Ft</span></b></a></td></tr><tr><td bgcolor="#9a2067" colspan="2" height="36" style="background:#9a2067;font-family:Arial,Helvetica,sans-serif;font-size:15px;height:36px;text-align:center;vertical-align:middle;width:196px;" valign="top" width="196"><a href="http://clickshop.hu/lg-42lb5610-full-hd-led-televizio--20678/?utm_source=optimail&utm_campaign=BTS&utm_medium=edm_09_09" style="color:#ffffff;display:block;text-decoration:none;" target="_blank"><span style="color:#ffffff;">MEGNÉZEM</span></a></td></tr></table></td></tr></table></td></tr> ';

$(document).ready(function() {
    console.log("we're running motherfucker");

    $(document).on("click", "span", function(e) {
        e.preventDefault();
        console.log("span");
        $(this).attr('contentEditable', true);
    }).blur(
        function() {
            $(this).attr('contentEditable', false);
        });
    $("a").click(function(e) {
        e.preventDefault();
        $(this).attr('contentEditable', true);
    }).blur(
        function() {
            $(this).attr('contentEditable', false);
        });

    $("#add_newsletter_section").click(function(e) {
        e.preventDefault();
        $(section)
        .appendTo("#maintable")
        .hide().fadeIn("slow");
//        $("#maintable").append(section).hide().fadeIn("slow");
    });

    $("#add_newsletter_section_header").click(function(e) {
        e.preventDefault();
        $(sectionheader)
        .appendTo("#maintable")
        .hide().fadeIn("slow");
//        $("#maintable").append(section).hide().fadeIn("slow");
    });


    $(document).on("click", "#save_all_this_shit", function(e) {
        e.preventDefault();
        var htmldata = $("table#newsletter").html();
        console.log(htmldata); 
        $.post("save.py", {html: htmldata})
        .done(function( data ) {
            console.log(data);
        });
//        $("#maintable").append(section).hide().fadeIn("slow");
    });

    function encode_utf8(s) {
      return unescape(encodeURIComponent(s));
    }

    function decode_utf8(s) {
      return decodeURIComponent(escape(s));
    }

    /* jQuery UI - parts */
    function addProduct() {
        // url manipulation of products
        var url = $("#url").val();
        console.log("ez az: "+ url)

            var splitted = url.split('/');
            var path = "http://static.origos.hu/s/partners/maileon/img/clickshop/hirlevel/"
            var imgurl = path + splitted[3] + ".jpg";

            url = url + "?hirlevel=valami";

        $(".selected").find("a").attr("href", url);
        $(".selected").find("img").attr("src", imgurl);

        $.ajax({
            url: "test.py",
            type: "post",
            datatype: "json",
            data: {'url':url},
            success: function(response) {
                console.log(response.message);
                console.log(response.keys);
                console.log(response.data);
                var name = response.productName;
                console.log(response);
                console.log(name);
            },
            error: function(response) {
                console.log("FAIL")
                console.log(response)
            }
            
        });
        $(".selected").removeClass("selected");
        dialog.dialog("close");
        return true;
    }

    dialog = $("#dialog-form").dialog({
           autoOpen: false,
           height: 300,
           width: 550,
           modal: true,
           buttons: {
               "Add product": addProduct
               /*Cancel: function() {
                   $("#url").removeClass("ui-state-error");
               }*/
           }
    });

    form = dialog.find("form").on("submit", function(e) {
    });
         
            
    $(document).on("click", "img", function(e) {
        e.preventDefault();
        console.log("img");
        dialog.dialog("open");
        $(this).closest("table").addClass("selected");
    });
           
    $(document).on("click", "#delete", function(e) {
        e.preventDefault();
        console.log("delete");
        var spacer = $(this).closest("tr.spacer").prev('tr');
        $(spacer).remove();
        $(this).closest("tr").remove().fadeOut("slow");
    });


});

